# This file is a part of Voody Blue Subtitler suit.
# 
# Author: Assen Totin <assen.totin@gmail.com>
#
# Home page: http://bilbo.online.bg/~assen/vbs
#
# This software is released under GNU General Public License.
# See the LICENSE file for details or visit http://www.gnu.org/copyleft/gpl.html 
# for details.

CC = @MAKEFILE_CC@
CFLAGS = -c -O2

BINDIR = @BINDIR@ 

TARGET = vbsm

INCLUDES=`pkg-config --cflags gtk+-2.0`
LIBS=`pkg-config --cflags --libs gtk+-2.0`
OBJS_REMOTE = ../common/error.o ../common/cfg.o ../common/network.o ../common/util.o ../common/menu.o
OBJS_LOCAL = gui.o keyboard.o mouse.o export.o edit.o import.o video-mplayer.o vbsm.o menu.o
ADD_LIBS = 

HAVE_MPLAYER = @HAVE_MPLAYER@
HAVE_GSTREAMER = @HAVE_GSTREAMER@
HAVE_MPLAYER_GSTREAMER = @HAVE_MPLAYER_GSTREAMER@

ifeq($(HAVE_MPLAYER),1)
	OBJS_VIDEO = video-mplayer.o
endif
ifeq($(HAVE_GSTREAMER),1)
	OBJS_VIDEO = video-gstreamer.o
	ADD_LIBS = `pkg-config --cflags --libs gstreamer-0.10`
	ADD_INCLUDES = `pkg-config --cflags --libs gstreamer-0.10`
endif
ifeq($(HAVE_MPLAYER_GSTREAMER),1)
	OBJS_VIDEO = video-mplayer.o video-gstreamer.o 
	ADD_LIBS = `pkg-config --cflags --libs gstreamer-0.10`
	ADD_INCLUDES = `pkg-config --cflags --libs gstreamer-0.10`
endif

all: $(TARGET)

clean:
	rm -f $(OBJS_LOCAL) $(TARGET) vbsm.desktop

distclean:
	make clean
	rm -f Makefile vbsm.desktop

install:
	test -z $(DESTDIR)$(BINDIR) || mkdir -p $(DESTDIR)$(BINDIR)
	cp -f $(TARGET) $(BINDIR)
	test -z $(DESTDIR)$(DATAROOTDIR)/applications || mkdir -p $(DESTDIR)$(DATAROOTDIR)/applications
	cp -f vbsm.desktop $(DESTDIR)$(DATAROOTDIR)/applications

uninstall:
	rm -f $(TARGET) $(BINDIR)/$(TARGET)
	rm -f $(DATAROOTDIR)/applications/vbsm.desktop

$(TARGET): gui.c keyboard.c mouse.c export.c import.c video-mplayer.c video-gstreamer.c edit.c vbsm.c menu.c
	$(CC) $(CFLAGS) $(INCLUDES) gui.c
	$(CC) $(CFLAGS) $(INCLUDES) keyboard.c
	$(CC) $(CFLAGS) $(INCLUDES) mouse.c
	$(CC) $(CFLAGS) $(INCLUDES) export.c
	$(CC) $(CFLAGS) $(INCLUDES) import.c
	$(CC) $(CFLAGS) $(INCLUDES) edit.c
	$(CC) $(CFLAGS) $(INCLUDES) menu.c
	$(CC) $(CFLAGS) $(INCLUDES) vbsm.c
	ifeq($(HAVE_MPLAYER),1)
		$(CC) $(CFLAGS) $(INCLUDES) video-mplayer.c
	endif
	ifeq($(HAVE_GSTREAMER),1)
		$(CC) $(CFLAGS) $(INCLUDES) $(ADD_INCLUDES) video-gstreamer.c
	endif
	$(CC) -o $@ $(LIBS) $(ADD_LIBS) $(OBJS_LOCAL) $(OBJS_VIDEO) $(OBJS_REMOTE)

