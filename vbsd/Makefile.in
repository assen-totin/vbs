# This file is a part of Voody Blue Subtitler suit.
# 
# Author: Assen Totin <assen.totin@gmail.com>
#
# Home page: http://www.zavedil.com/software-desktop-vbs
#
# This software is released under GNU General Public License.
# See the LICENSE file for details or visit http://www.gnu.org/copyleft/gpl.html 
# for details.

CC = @MAKEFILE_CC@
CFLAGS = -c -O2

LIBS = -lm

SBINDIR = @SBINDIR@

TARGET = vbsd 

OBJS_LOCAL = vbsd.o 
OBJS_REMOTE = ../common/error.o ../common/cfg.o ../common/network.o ../common/util.o 

INCLUDES=`pkg-config --cflags gtk+-@GTK_VER@`
ADD_FLAGS=`pkg-config --cflags --libs gtk+-@GTK_VER@`

HAVE_SYSTEMD = @HAVE_SYSTEMD@

HAVE_GSTREAMER = @HAVE_GSTREAMER@
ifeq ($(HAVE_GSTREAMER),1)
	ADD_INCLUDES = `pkg-config --cflags gstreamer-0.10`
endif

all: $(TARGET)

clean:
	rm -f $(OBJS_LOCAL) $(TARGET) 

distclean:
	make clean
	rm -f Makefile

install:
	test -z $(DESTDIR)$(SBINDIR) || mkdir -p $(DESTDIR)$(SBINDIR)
	cp -f $(TARGET) $(DESTDIR)$(SBINDIR)
	test -z $(DESTDIR)/etc/init.d || mkdir -p $(DESTDIR)/etc/init.d
	cp -f init/vbsd $(DESTDIR)/etc/init.d/vbsd
ifeq ($(HAVE_SYSTEMD),1)
	test -z $(DESTDIR)/etc/systemd/system || mkdir -p $(DESTDIR)/etc/systemd/system
	cp -f init/vbsd.service $(DESTDIR)/etc/systemd/system/vbsd.service
endif

uninstall:
	rm -f $(TARGET) $(SBINDIR)/$(TARGET)

$(TARGET): vbsd.c
	$(CC) $(CFLAGS) $(INCLUDES) $(ADD_INCLUDES)  vbsd.c
	$(CC) -o $@ $(LIBS) $(ADD_FLAGS) $(OBJS_LOCAL) $(OBJS_REMOTE)

